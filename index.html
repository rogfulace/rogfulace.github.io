<script>
    $(document).ready(function(){
        var date = moment.utc();
        var currentDate2 = date.format('DD/MMM/YYYY').toUpperCase();
        $("#datetime").val(currentDate2);
        $("#datetimetext1").text(currentDate2);
        $("#datetimetext2").text(currentDate2);

        // General live update function
        function bindUpdate(inputId, targetId) {
            $("#" + inputId).on("input", function() {
                $("#" + targetId).text($(this).val());
            });
        }

        bindUpdate("coronername", "coronertext");
        bindUpdate("victimname", "victimText1");
        bindUpdate("victimname", "victimText2");
        bindUpdate("victimnameooc", "victimnameoocText");
        bindUpdate("placeofdeath", "placeofdeathText");
        bindUpdate("coronerbadge", "badgetext");
        bindUpdate("datetime", "datetimetext1");
        bindUpdate("datetime", "datetimetext2");
        bindUpdate("time", "timeText");
        bindUpdate("timeofdeath", "timeofdeathText");
        bindUpdate("causeofdeath", "causeofdeathText");

        // Narrative textarea
        $("#narrative").on("input", function(){
            $("#narrativeText").text($(this).val());
        });

        // Scene Photography
        $("#images").on("input", function(){
            let allimgs = $(this).val().split(",").map(i => `[img]${i.trim()}[/img]`).join("");
            $("#imgs").text(allimgs);
        });

        // Morgue screen
        $("#morguescreen").on("input", function(){
            let allimgs = $(this).val().split(",").map(i => `[img]${i.trim()}[/img]`).join("");
            $("#morguescreenText").text(allimgs);
        });

        // Type of Death
        $("#typeofdeath").on("change", function(){
            let v = $(this).val();
            $("#deathText1, #deathText2").text(v);
        });

        // Job title
        $("#jobtitle").on("change", function(){
            let roles = {
                "F": "Forensic Attendant",
                "C": "Coroner Investigator",
                "M": "Medical Examiner"
            };
            let r = roles[$(this).val()];
            $("#jobText1, #jobText2, #jobText3, #jobText4").text(r);
        });

        // Manner of Death
        $("#mannerofdeath").on("change", function(){
            let modes = {
                "N": "Natural",
                "A": "Accident",
                "S": "Suicide",
                "H": "Homicide",
                "U": "Undetermined"
            };
            $("#mannerofdeathText").text(modes[$(this).val()]);
        });

        // Requesting Agency
        $("#requestingagency").on("change", function(){
            let agencies = {
                "FD": "Los Santos Fire Department",
                "PD": "Los Santos Police Department",
                "SD": "Los Santos Sheriff's Department",
                "PR": "San Andreas Park Rangers",
                "PHMC": "Pillbox Hill Medical Center"
            };
            $("#requestingagencyText").text(agencies[$(this).val()]);
        });
    });

    // Fix copy to include plain text with line breaks
    function copy_data(containerid) {
        let el = (typeof containerid === "string") ? document.getElementById(containerid) : containerid;
        let text = el.innerText.replace(/\u00A0/g, " "); // clean nbsp
        navigator.clipboard.writeText(text).then(() => {
            alert("BBCode Copied");
        });
    }
</script>
